(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d210644"],{"7d12":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("DisFileUpload",{attrs:{uploadPath:e.uploadPath},on:{uploaded:e.addUploadedFile}}),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm12:"",md6:"",lg8:"",xl9:""}},[a("v-data-table",{staticClass:"uploadFiles",attrs:{headers:e.headers,items:e.items,"item-key":"name","select-all":"",loading:e.isTableRefreshing,pagination:e.pagination,totalItems:e.totalItems},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"items",fn:function(t){return[t.item.mime>""||t.item.mime.size>0?a("tr",{attrs:{active:e.activeFile&&e.activeFile.fullName===t.item.fullName},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),function(){return e.updateActiveFile(t.item)}()}}},[a("td",[a("v-checkbox",{attrs:{primary:"","hide-details":"",disabled:!e.fileMatchesTemplate(t.item.name)},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"props.selected"}})],1),a("td",[e._v(e._s(t.item.name))]),a("td",[e._v(e._s(t.item.mime))]),a("td",[e._v(e._s(t.item.size_h))]),a("td",[e._v(e._s(t.item.modified))])]):e._e(),a("tr"),""==t.item.mime&&0===t.item.size?a("tr",{staticClass:"folder",on:{click:function(a){return a.preventDefault(),a.stopPropagation(),function(){return e.changeUploadPath(t.item)}()}}},[a("td"),a("td",{staticClass:"folder-name"},[e._v(e._s(".."===t.item.name?"â† back":t.item.name))]),a("td"),a("td"),a("td")]):e._e(),a("tr")]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),a("v-form",{staticClass:"mt-4"},[a("v-card",[a("v-card-title"),a("v-card-text",[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm12:"",lg6:""}},[a("v-combobox",{attrs:{items:e.listValues,label:"Template to set filters by file name. (This overrides the settings below.)",clearable:"","append-outer-icon":"list_alt"},on:{"click:append-outer":function(t){e.editTemplatesDialog=!0}},model:{value:e.filenameTemplate,callback:function(t){e.filenameTemplate=t},expression:"filenameTemplate"}}),e._l(Object.keys(e.assignIds).filter((function(e){return"person"!==e})),(function(t){return a("v-autocomplete",{key:t,attrs:{loading:e.isLoadingList,items:e.assignIds[t].listItems,label:t,clearable:"","prepend-icon":"expedition"!==t?"refresh":null,"error-messages":e.getFieldErrors(t)},on:{"click:prepend":function(a){"expedition"!==t&&e.updateCascadeList(e.assignIds[t].parent,e.assignIds[e.assignIds[t].parent].value)},change:function(a){return e.updateCascadeList(t,a)}},model:{value:e.assignIds[t].value,callback:function(a){e.$set(e.assignIds[t],"value",a)},expression:"assignIds[assignId].value"}})}))],2),a("v-flex",{attrs:{sm12:"",lg6:""}},[a("dis-select-input",{staticStyle:{padding:"0"},attrs:{name:"fileType",label:"Type",serverValidationErrors:e.serverValidationErrors,selectSource:{type:"list",listName:"UPLOAD_FILE_TYPE",textField:"remark",valueField:"display"},allowFreeInput:!1,multiple:!1},model:{value:e.fileType,callback:function(t){e.fileType=t},expression:"fileType"}}),a("v-text-field",{attrs:{"error-messages":e.getFieldErrors("number"),label:"Number (i.e. Core box number)"},model:{value:e.number,callback:function(t){e.number=t},expression:"number"}}),a("v-textarea",{attrs:{"error-messages":e.getFieldErrors("comment"),label:"Additional Information"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),a("dis-date-time-input",{attrs:{"data-input":"true",name:"fileDate",label:"* Upload Date",serverValidationErrors:e.serverValidationErrors},model:{value:e.fileDate,callback:function(t){e.fileDate=t},expression:"fileDate"}}),e.assignIds.hasOwnProperty("person")?a("div",[a("v-autocomplete",{attrs:{loading:e.isLoadingList,items:e.assignIds["person"].listItems,label:"* Uploaded By",clearable:"","error-messages":e.getFieldErrors("person")},on:{"click:prepend":function(t){e.assignIds[e.assignIds["person"].parent].value}},model:{value:e.assignIds["person"].value,callback:function(t){e.$set(e.assignIds["person"],"value",t)},expression:"assignIds['person'].value"}})],1):e._e()],1),a("v-flex",{attrs:{xs12:""}},[e.serverValidationErrors.length?a("v-alert",{attrs:{value:!0,type:"error"}},[a("ul",e._l(e.serverValidationErrors,(function(t,r){return a("li",{key:r},[a("strong",[e._v(e._s(t.field))]),e._v(": "+e._s(t.message)+" ")])})),0)]):e._e()],1)],1)],1),a("v-card-actions",[a("v-btn",{attrs:{color:"green",loading:e.isAssignLoading,disabled:0===e.selected.length},on:{click:e.assignSelectedFiles}},[e._v("Assign Selected Files ("+e._s(e.selected.length)+")")]),a("v-btn",{attrs:{color:"red",loading:e.isDeletingLoading,disabled:0===e.selected.length},on:{click:e.deleteSelectedFiles}},[e._v("Delete Selected Files ("+e._s(e.selected.length)+")")]),e.isUserAllowedToImport?a("v-btn",{attrs:{disabled:1!==e.selected.length,color:"brown darken-2",dark:""},on:{click:e.openImportDialog}},[e._v("Import data")]):e._e()],1)],1)],1)],1),a("v-flex",{attrs:{sm12:"",md6:"",lg4:"",xl3:""}},[e.activeFileMetaData?a("div",{staticClass:"meta-data v-card v-sheet theme--light"},[e.activeFileMetaData.thumbnail&&e.activeFile&&e.activeFile.mime.startsWith("image/")?a("div",{staticClass:"preview"},[a("h3",[e._v("Preview of")]),a("div",[e._v("."+e._s(e.activeFile.fullName))]),e.activeFileMetaData.thumbnail&&e.activeFile&&e.activeFile.mime.startsWith("image/")?a("v-img",{staticClass:"meta-data__thumbnail",attrs:{alt:"."+e.activeFile.fullName,title:"."+e.activeFile.fullName,src:e.activeFileMetaData.thumbnail}}):e._e()],1):a("h3",{staticClass:"preview"},[e._v("No preview available for '."+e._s(e.activeFile.fullName)+"'")]),e._l(Object.keys(e.activeFileMetaData).filter((function(e){return"thumbnail"!==e})),(function(t){return a("div",{key:t,staticClass:"meta-data__section"},[a("h3",[e._v(e._s(t))]),a("table",e._l(e.activeFileMetaData[t],(function(t,r){return a("tr",{key:r},[a("td",[e._v(e._s(r))]),a("td",{staticClass:"ow"},[e._v(e._s(t))])])})),0)])}))],2):e._e()]),a("v-dialog",{attrs:{persistent:"","max-width":"400px"},model:{value:e.importerDialog,callback:function(t){e.importerDialog=t},expression:"importerDialog"}},[a("v-card",[a("v-form",{ref:"importForm"},[a("v-card-title",[a("span",{staticClass:"headline"},[e._v("Import")])]),a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-text-field",{attrs:{label:"Import File",value:e.selected[0]?e.selected[0].name:null,disabled:"",required:""}})],1),a("v-divider"),a("v-flex",{attrs:{xs12:""}},[a("v-select",{attrs:{items:e.importersList,label:"Importer*",rules:[function(e){return!!e||"this field is required."}],required:""},model:{value:e.importerFormModel.importerName,callback:function(t){e.$set(e.importerFormModel,"importerName",t)},expression:"importerFormModel.importerName"}})],1),a("v-flex",{attrs:{xs12:""}},[a("v-autocomplete",{attrs:{disabled:"ListValues"===e.importerFormModel.importerName,rules:[e.validateDateModel],items:e.$store.state.templates.summary.models.map((function(e){return e.fullName})),label:"Data Model (Linked Table)"},model:{value:e.importerFormModel.dataModel,callback:function(t){e.$set(e.importerFormModel,"dataModel",t)},expression:"importerFormModel.dataModel"}})],1),a("v-flex",{attrs:{xs12:""}},[a("v-checkbox",{attrs:{label:"Only test data, do NOT import","hide-details":""},model:{value:e.importerFormModel.dryRun,callback:function(t){e.$set(e.importerFormModel,"dryRun",t)},expression:"importerFormModel.dryRun"}}),a("v-checkbox",{attrs:{label:"Stop at first error","hide-details":""},model:{value:e.importerFormModel.stopAtFirstError,callback:function(t){e.$set(e.importerFormModel,"stopAtFirstError",t)},expression:"importerFormModel.stopAtFirstError"}}),a("v-checkbox",{attrs:{label:"DELETE data set shown above, undo import","hide-details":""},model:{value:e.importerFormModel.delete,callback:function(t){e.$set(e.importerFormModel,"delete",t)},expression:"importerFormModel.delete"}})],1)],1)],1)],1),a("v-card-actions",[a("v-btn",{attrs:{color:"red darken-1",dark:""},on:{click:function(t){e.importerDialog=!1}}},[e._v("Cancel")]),a("v-spacer"),a("v-btn",{attrs:{color:"brown darken-2",dark:""},on:{click:e.onImportClick}},[e._v("Start import")])],1)],1)],1)],1),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:e.editTemplatesDialog,callback:function(t){e.editTemplatesDialog=t},expression:"editTemplatesDialog"}},[a("v-card",[a("v-toolbar",{attrs:{dark:"",color:"primary"}},[a("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){return e.closeTemplatesDialog(t)}}},[a("v-icon",[e._v("close")])],1),a("v-toolbar-title",[e._v("List Values ["+e._s(e.valueList)+"]")]),a("v-spacer")],1),a("v-card-text",[e.editTemplatesDialog?a("dis-list-values-form",{attrs:{listName:e.valueList}}):e._e()],1)],1)],1)],1)],1)},i=[],s=a("1da1"),l=(a("96cf"),a("7db0"),a("d3b7"),a("ddb0"),a("d81d"),a("99af"),a("159b"),a("4de4"),a("caad"),a("2532"),a("b0c0"),a("ac1f"),a("5319"),a("00b4"),a("466d"),a("498a"),a("4d63"),a("c607"),a("2c3e"),a("25f0"),a("8809")),n=a("4851"),o=a("5cce"),c={name:"ArchiveFileUpload",mixins:[n["a"]],data:function(){return{uploadPath:"/",selected:[],items:[],headers:[{text:"Files",value:"name"},{text:"Mime",value:"mime"},{text:"Size",value:"size"},{text:"Modified",value:"modified"}],isTableRefreshing:!1,pagination:{descending:!1,page:1,rowsPerPage:5,sortBy:"id",totalItems:0},totalItems:0,assignIds:{},refreshOnPagination:!0,isLoadingList:!1,fileType:null,fileDate:null,analyst:null,number:null,remarks:null,isAssignLoading:!1,serverValidationErrors:[],activeFile:null,activeFileMetaData:null,isDeletingLoading:!1,importerDialog:!1,editTemplatesDialog:!1,importerFormModel:{importerName:null,dataModel:null,dryRun:!0,stopAtFirstError:!1,delete:!1},valueList:"IMPORT_FILENAME_TEMPLATES",listValues:[],filenameTemplate:"",filenameTemplateRegExp:null}},created:function(){this.service=new l["a"],this.$store.dispatch("importers/refreshList"),this.valueListService=new o["a"]("ListValues")},mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("templates/getFormTemplate","files");case 2:for(i in a=e.$store.state.templates.forms.find((function(e){return"ArchiveFile"===e.dataModel})).filterDataModels,r={},a)r[i]={value:null,listItems:[],column:a[i].ref};return e.assignIds=r,e.getValueListItems(),t.next=9,e.updateCascadeList("",0);case 9:if(!e.urlFilter){t.next=19;break}t.t0=regeneratorRuntime.keys(a);case 11:if((t.t1=t.t0()).done){t.next=19;break}if(s=t.t1.value,!e.urlFilter[s]){t.next=17;break}return e.assignIds[s].value=e.urlFilter[s],t.next=17,e.updateCascadeList(s,e.urlFilter[s]);case 17:t.next=11;break;case 19:case"end":return t.stop()}}),t)})))()},methods:{getValueListItems:function(){var e=this;this.valueListService.getList({sort:"sort"},{listname:this.valueList}).then((function(t){e.listValues=t.items.map((function(e){return{text:e.display+(e.remark&&e.remark!==e.display?" ("+e.remark+")":""),value:e.display}})),console.log("")}))},closeTemplatesDialog:function(){this.getValueListItems(),this.editTemplatesDialog=!1},refreshItems:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.headers[0].text="Files in upload directory '"+e.uploadPath+"'",e.activeFileMetaData=null,e.isTableRefreshing=!0,e.refreshOnPagination=!1,t.prev=4,a=e.pagination.rowsPerPage>0?{path:e.uploadPath,"per-page":e.pagination.rowsPerPage,page:e.pagination.page,sort:"".concat(e.pagination.descending?"-":"").concat(e.pagination.sortBy)}:{path:e.uploadPath,"per-page":-1,sort:"".concat(e.pagination.descending?"-":"").concat(e.pagination.sortBy)},t.next=8,e.service.get(a);case 8:r=t.sent,e.items=r.items,e.totalItems=r._meta.totalCount,e.pagination.rowsPerPage=r._meta.perPage,e.pagination.page=r._meta.currentPage,t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](4),e.$dialog.notify.warning("unable to get files list"),console.log(t.t0);case 19:return t.prev=19,e.refreshOnPagination=!0,e.isTableRefreshing=!1,console.log("refresh: selected=",e.selected),i=[],e.items.forEach((function(e){i.push(e.fullName)})),e.selected=e.selected.filter((function(e){return i.includes(e.fullName)})),t.finish(19);case 27:case"end":return t.stop()}}),t,null,[[4,15,19,27]])})))()},updateCascadeList:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var i,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log(e,t),a.isLoadingList=!0,r.prev=2,r.next=5,a.service.updateSelectValues(e,t);case 5:for(s in i=r.sent,i)a.assignIds[s].listItems=i[s];r.next=13;break;case 9:r.prev=9,r.t0=r["catch"](2),a.$dialog.notify.warning("unable to get select list options"),console.log(r.t0);case 13:return r.prev=13,a.isLoadingList=!1,r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[2,9,13,16]])})))()},assignSelectedFiles:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(r in e.isAssignLoading=!0,e.serverValidationErrors=[],a={},e.assignIds)a[r]=e.assignIds[r].value;return t.prev=4,t.next=7,e.service.assign({assignIds:a,filenameTemplate:e.filenameTemplate&&e.filenameTemplate.value?e.filenameTemplate.value:e.filenameTemplate,fileType:e.fileType,fileDate:e.fileDate,analyst:e.analyst,number:e.number,remarks:e.remarks,selectedFilenames:e.selected.map((function(e){return e.fullName})),actionSave:!0});case 7:i=t.sent,e.$dialog.message.success("".concat(i," files were assigned")),e.refreshItems(),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](4),t.t0.response&&422===t.t0.response.status?e.serverValidationErrors=t.t0.response.data:(e.$dialog.notify.warning("error happened while trying to assign files"),console.log(t.t0)),e.refreshItems();case 16:return t.prev=16,e.isAssignLoading=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[4,12,16,19]])})))()},deleteSelectedFiles:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("deleteSelectedFiles:",e.selected),e.isDeletingLoading=!0,e.serverValidationErrors=[],t.prev=3,t.next=6,e.service.delete({selectedFilenames:e.selected.map((function(e){return e.fullName})),actionDelete:!0});case 6:e.$dialog.message.success("files were deleted successfully"),e.refreshItems(),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](3),t.t0.response&&422===t.t0.response.status?e.serverValidationErrors=t.t0.response.data:(e.$dialog.notify.warning("error happened while trying to delete files"),console.log(t.t0));case 13:return t.prev=13,e.isDeletingLoading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[3,10,13,16]])})))()},getFieldErrors:function(e){return this.serverValidationErrors.filter((function(t){return t.field===e})).map((function(e){return e.message}))},addUploadedFile:function(e){this.refreshItems()},updateActiveFile:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.activeFile&&(!t.activeFile||e.fullName===t.activeFile.fullName)&&t.activeFileMetaData){a.next=14;break}return t.activeFile=e,t.activeFileMetaData=null,a.prev=3,a.next=6,t.service.metaData(e.fullName);case 6:r=a.sent,t.activeFile&&r.filename===t.activeFile.fullName&&(delete r["filename"],t.activeFileMetaData=r),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](3),t.$dialog.notify.warning("error while getting file meta data"),console.log(a.t0);case 14:case"end":return a.stop()}}),a,null,[[3,10]])})))()},changeUploadPath:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:".."===e.name?t.uploadPath=t.uploadPath.replace(/[^/]+\/$/,""):t.uploadPath+=e.name+"/",console.log("uploadPath",t.uploadPath),t.refreshItems();case 3:case"end":return a.stop()}}),a)})))()},fileMatchesTemplate:function(e){return!this.filenameTemplateRegExp||this.filenameTemplateRegExp.test(e)},onImportClick:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=!0,!e.importerFormModel.delete){t.next=5;break}return t.next=4,e.$dialog.confirm({title:"Delete Records",text:"Are you sure you want to delete the records defined in the import file?"});case 4:a=t.sent;case 5:e.$refs.importForm.validate()&&a&&(r="".concat(e.baseUrl,"importer/").concat(e.importerFormModel.importerName,"?filename=")+encodeURIComponent("".concat(e.selected[0]&&e.selected[0].fullName))+"&modelName=".concat(e.importerFormModel.dataModel)+"&stopOnErrors=".concat(e.importerFormModel.stopAtFirstError)+"&dryRun=".concat(e.importerFormModel.dryRun)+"&deleteRecords=".concat(e.importerFormModel.delete),window.open(r));case 6:case"end":return t.stop()}}),t)})))()},openImportDialog:function(){this.importerFormModel.importerName=null,this.importerFormModel.dataModel=null,this.importerFormModel.dryRun=!0,this.importerFormModel.stopAtFirstError=!1,this.importerDialog=!0},validateDateModel:function(e){var t=this;if(this.importerFormModel.importerName){var a=this.$store.state.importers.list.find((function(e){return e.class===t.importerFormModel.importerName}));if(a&&a.modelNameRequired&&!e)return"model name is required."}return!0}},computed:{isUserAllowedToImport:function(){return console.log(this.$store.state.loggedInUser),this.$store.state.loggedInUser&&(this.$store.state.loggedInUser.roles.includes("operator")||this.$store.state.loggedInUser.roles.includes("developer")||this.$store.state.loggedInUser.roles.includes("sa"))},importersList:function(){var e=this;return this.$store.state.importers.list&&this.$store.state.importers.list.length>0?this.$store.state.importers.list.filter((function(t){return e.selected[0]&&e.selected[0].name.match(t.extensionRegExp)})).map((function(e){return{text:e.title,value:e.class}})):[]},baseUrl:function(){return window.baseUrl}},watch:{pagination:{deep:!0,immediate:!1,handler:function(e,t){this.refreshOnPagination&&this.refreshItems()}},"importerFormModel.importerName":function(e){"ListValues"===e&&(this.importerFormModel.dataModel=null)},filenameTemplate:function(e){var t=this;e&&e.value&&(e=e.value),console.log("watch filenameTemplate",e),e&&e.trim().length?(e=e.replace(/(^\^|\$$)/,"").replace(/\./,"\\.").replace(/<[^>]+>/g,"([0-9a-zA-Z]+)").replace(/\*/g,".*?"),e="^"+e+"$",this.filenameTemplateRegExp=new RegExp(e),this.selected=this.selected.filter((function(e){return t.fileMatchesTemplate(e.name)}))):this.filenameTemplateRegExp=null}}},d=c,m=(a("b7f3"),a("a03c"),a("2877")),u=a("6544"),p=a.n(u),f=a("0798"),v=a("c6a6"),g=a("8336"),h=a("b0af"),b=a("99d9"),F=a("12b2"),x=a("ac7c"),k=a("2b5d"),w=a("a523"),I=a("8fea"),_=a("169a"),M=a("ce7e"),y=a("0e8f"),T=a("4bd4"),D=a("132d"),L=a("adda"),V=a("a722"),E=a("b56d"),R=a("9910"),P=a("2677"),$=a("a844"),N=a("71d9"),C=a("2a7f"),A=Object(m["a"])(d,r,i,!1,null,"d7c19f20",null);t["default"]=A.exports;p()(A,{VAlert:f["a"],VAutocomplete:v["a"],VBtn:g["a"],VCard:h["a"],VCardActions:b["a"],VCardText:b["b"],VCardTitle:F["a"],VCheckbox:x["a"],VCombobox:k["a"],VContainer:w["a"],VDataTable:I["a"],VDialog:_["a"],VDivider:M["a"],VFlex:y["a"],VForm:T["a"],VIcon:D["a"],VImg:L["a"],VLayout:V["a"],VSelect:E["a"],VSpacer:R["a"],VTextField:P["a"],VTextarea:$["a"],VToolbar:N["a"],VToolbarTitle:C["a"]})},"8fb5":function(e,t,a){},a03c:function(e,t,a){"use strict";a("d67c")},b7f3:function(e,t,a){"use strict";a("8fb5")},d67c:function(e,t,a){}}]);
//# sourceMappingURL=chunk-6d210644.c9bd5651.js.map